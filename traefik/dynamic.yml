http:
  routers:
    websocket:
      rule: "Path(`/ws`)"
      entryPoints:
        - web
      service: team-server-host
      priority: 100

    # Auth callback route with rate limiting
    auth-callback:
      rule: "PathPrefix(`/auth/callback`)"
      entryPoints:
        - web
      service: team-dashboard
      middlewares:
        - auth-rate-limit
      priority: 90

  middlewares:
    # Rate limiting for auth endpoints: 10 requests per minute per IP
    # Uses CF-Connecting-IP for accurate client IP behind Cloudflare
    auth-rate-limit:
      rateLimit:
        average: 10
        period: 1m
        burst: 5
        sourceCriterion:
          requestHeaderName: CF-Connecting-IP

  services:
    team-server-host:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:3030"

    team-dashboard:
      loadBalancer:
        servers:
          - url: "http://team-dashboard:3000"
